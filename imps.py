#!/usr/bin/python
#  -*- coding: utf-8 -*-
# Made by IMPS

from urlparse import urlparse
import requests, sys, re, datetime

VERSION = "0.0.1"

if len(sys.argv)>1:
	print "\n\t\033[1m\033[91m*****************************************************************"
	print "\t*								*"
	print "\t*			WPExploit "+VERSION+"				*"
	print "\t*			Sponsored by IMPS			*"
	print "\t*								*"	
	print "\t*****************************************************************"
	print "\tlegal disclaimer:\033[1m Usage of wpexploit for attacking targets without prior mutual consent is illegal."
	print "\tIt is the end user's responsibility to obey all applicable local, state and federal laws."
	print "\tDevelopers assume no liability and are not responsible for any misuse or damage caused by this program\033[0m\n"
	
	PARSED			= urlparse(sys.argv[1])
	URL				= PARSED.geturl()
	PORT			= PARSED.port if PARSED.port else 80

	try:
	
		class exploits:
	
			def _422(self):
				print "\t"
	
	
		r = requests.head(URL)
		if r.status_code==200 or 302:
		
			home	= requests.get(URL)
			if all(x in home.text for x in ['wp-includes', 'wp-content']):
			
				now = datetime.datetime.now()
				print "\tURL: "+URL
				print "\tStarted: "+str(now.day)+"/"+str(now.month)+"/"+str(now.year)+" "+str(now.hour)+":"+str(now.minute)+":"+str(now.second)+"\n"
				
				if r.headers['X-Powered-By']:
					print "\t\033[1m\033[91m"+r.headers['X-Powered-By']+"\033[0m"
				
				if r.headers['Server']:
					print "\t\033[1m\033[91m"+r.headers['Server']+"\033[0m"
			
				version	= requests.get(URL+"/readme.html")
				print str("\t\033[1m\033[91mWordpress version: ")+str(".".join(re.findall(r'\b\d+\b', version.text.split("logo.png")[1].split("</h1>")[0])))+str("\033[0m")
				
				rpc_enabled	= requests.head(URL+"/xmlrpc.php")
				if rpc_enabled.status_code==405:
					print "\t\033[1m\033[91mXML-RPC Interface available under: "+URL+"/xmlrpc.php\033[0m"
					
				print "\n"
				print "\t\033[1m\033[91m[No available exploits]\033[0m\n"
				
			else:
				print "\tThe remote website is up, but does not seem to be running WordPress."			
			
	except requests.ConnectionError:
		print "\t\033[1m\033[91mhost "+URL+" does not exist\033[0m\n"

else:
	print "\nUsage: \n\t# python "+sys.argv[0]
